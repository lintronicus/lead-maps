<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lead Properties Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    .mapboxgl-popup { max-width: 400px; font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; }
    #title { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; z-index: 1; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="title"></div>
  <div id="map"></div>
  <script>
    mapboxgl.accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';
    
    // Get lead name from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const leadName = urlParams.get('lead');
    
    document.getElementById('title').innerHTML = `<h3>${leadName || 'All Properties'}</h3>`;
    
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v11',
      center: [-118.6489, 34.1563],
      zoom: 15
    });

    // You would replace this with an API call or data structure that contains all properties
    const allProperties = {
      "type": "FeatureCollection",
      "features": [
        {"type":"Feature","properties":{"Lead Name":"Calabasas - SOCAL","Property Name":"23961 Craftsman Rd","Street Address":"23961 Craftsman Road, Calabasas, CA","Asset Class":"Light Industrial","Sq Ft":23388,"# Units":12},"geometry":{"type":"Point","coordinates":[-118.6497,34.1563]}},
        {"type":"Feature","properties":{"Lead Name":"Calabasas - SOCAL","Property Name":"5101 Douglas Fir Rd","Street Address":"5101-5111 & 5115 Douglas Fir Road, Calabasas, CA","Asset Class":"Light Industrial","Sq Ft":44830,"# Units":16},"geometry":{"type":"Point","coordinates":[-118.6489,34.15646]}},
        {"type":"Feature","properties":{"Lead Name":"Calabasas - SOCAL","Property Name":"23907 Ventura Blvd","Street Address":"23907-23947 Ventura Blvd. & 23930-23978 Craftsman Road, Calabasas, CA","Asset Class":"Light Industrial","Sq Ft":38429,"# Units":22},"geometry":{"type":"Point","coordinates":[-118.6479,34.15577]}},
        // You could add more properties for other leads here
        {"type":"Feature","properties":{"Lead Name":"Another Lead","Property Name":"Sample Property","Street Address":"123 Main St","Asset Class":"Office","Sq Ft":12000,"# Units":5},"geometry":{"type":"Point","coordinates":[-118.5000,34.0500]}}
      ]
    };
    
    // Filter properties for this lead
    const filteredFeatures = allProperties.features.filter(feature => 
      !leadName || feature.properties["Lead Name"].replace(/\s+/g, '-') === leadName
    );
    
    const filteredGeoJson = {
      "type": "FeatureCollection",
      "features": filteredFeatures
    };

    map.on('load', () => {
      // If we have properties, fit the map to them
      if (filteredFeatures.length > 0) {
        // Calculate bounds
        const bounds = new mapboxgl.LngLatBounds();
        filteredFeatures.forEach(feature => {
          bounds.extend(feature.geometry.coordinates);
        });
        map.fitBounds(bounds, { padding: 100 });
      }

      map.addSource('properties', {
        type: 'geojson',
        data: filteredGeoJson
      });
      
      map.addLayer({
        'id': 'property-points',
        'type': 'circle',
        'source': 'properties',
        'paint': {
          'circle-radius': 8,
          'circle-color': '#007cbf',
          'circle-stroke-width': 1,
          'circle-stroke-color': '#fff'
        }
      });

      // Add popups
      filteredFeatures.forEach(feature => {
        const coordinates = feature.geometry.coordinates.slice();
        const properties = feature.properties;
        
        const popup = new mapboxgl.Popup()
          .setHTML(`
            <h3>${properties["Property Name"]}</h3>
            <p>${properties["Street Address"]}</p>
            <p>Asset Class: ${properties["Asset Class"]}</p>
            <p>Sq Ft: ${properties["Sq Ft"].toLocaleString()}</p>
            <p>Units: ${properties["# Units"]}</p>
          `);
        
        new mapboxgl.Marker()
          .setLngLat(coordinates)
          .setPopup(popup)
          .addTo(map);
      });
    });
  </script>
</body>
</html>
